(this.webpackJsonpmodernptt=this.webpackJsonpmodernptt||[]).push([[0],{114:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.SelectQueryBuilder=void 0;var a=r(n(41)),i=r(n(51)),o=r(n(52)),s=r(n(40));function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,o.default)(this,n)}}var u=function(e){(0,i.default)(n,e);var t=c(n);function n(){(0,a.default)(this,n);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t.call.apply(t,[this].concat(r))}return n}(n(235).QueryBuilder);t.SelectQueryBuilder=u},134:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(113)),i=r(n(41)),o=r(n(68)),s=r(n(50)),c=r(n(51)),u=r(n(52)),l=r(n(40)),f=r(n(69));function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var h=function(e){(0,c.default)(n,e);var t=d(n);function n(e){var r;return(0,i.default)(this,n),r=t.call(this),(0,f.default)((0,s.default)(r),"_config",void 0),(0,f.default)((0,s.default)(r),"_socket",void 0),r._config=e,r}return(0,o.default)(n,[{key:"connect",value:function(){var e,t=this;if("undefined"===typeof WebSocket)throw new Error("'WebSocket' is undefined. Do you include any websocket polyfill?");if(1===WebSocket.length)e=new WebSocket(this._config.url),console.log("WebSocket 1",e,this._config);else{var n={};this._config.origin&&(n.origin=this._config.origin),e=new WebSocket(this._config.url,n)}e.addEventListener("open",this.emit.bind(this,"connect")),e.addEventListener("close",this.emit.bind(this,"disconnect")),e.addEventListener("error",this.emit.bind(this,"error"));var r,i=[];e.binaryType="arraybuffer",e.addEventListener("message",(function(e){var n,o=e.data;if(clearTimeout(r),(n=i).push.apply(n,(0,a.default)(new Uint8Array(o))),r=setTimeout((function(){t.emit("message",i),i=[]}),t._config.timeout),o.byteLength>t._config.blobSize)throw new Error("Receive message length(".concat(o.byteLength,") greater than buffer size(").concat(t._config.blobSize,")"))})),this._socket=e}},{key:"disconnect",value:function(){this._socket.close()}},{key:"send",value:function(e){var t=this._socket;1===t.readyState&&t.send(e)}}]),n}(r(n(121)).default);t.default=h},139:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={name:"PTT",url:"wss://ws.ptt.cc/bbs",charset:"utf8",origin:"app://pcman",protocol:"websocket",timeout:200,blobSize:1024,preventIdleTimeout:30,terminal:{columns:80,rows:24}};t.default=r},148:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"ptt",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"Config",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return o.default}});var a=r(n(181)),i=r(n(229)),o=r(n(134))},174:function(e,t,n){e.exports=n(258)},179:function(e,t,n){},181:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"bot",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"config",{enumerable:!0,get:function(){return i.default}});var a=r(n(182)),i=r(n(139))},182:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(120)),i=r(n(183)),o=r(n(80)),s=r(n(81)),c=r(n(41)),u=r(n(50)),l=r(n(68)),f=r(n(51)),d=r(n(52)),h=r(n(40)),p=r(n(69)),m=r(n(121)),b=r(n(188)),v=r(n(189)),y=r(n(134)),g=n(84),x=n(85),k=r(n(139));function w(e,t){w=function(e,t){return new s(e,void 0,t)};var n=(0,i.default)(RegExp),r=RegExp.prototype,o=new WeakMap;function s(e,t,r){var a=n.call(this,e,t);return o.set(a,r||o.get(e)),a}function c(e,t){var n=o.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return(0,f.default)(s,n),s.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=c(t,this)),t},s.prototype[Symbol.replace]=function(e,t){if("string"===typeof t){var n=o.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"===typeof t){var i=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==(0,a.default)(e[e.length-1])&&e.push(c(e,i)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},w.apply(this,arguments)}function E(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,i=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw a}}}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,p.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var a=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}var C=function(e){(0,f.default)(n,e);var t=B(n);function n(e){var r;return(0,c.default)(this,n),r=t.call(this),(0,p.default)((0,u.default)(r),"config",void 0),(0,p.default)((0,u.default)(r),"term",void 0),(0,p.default)((0,u.default)(r),"_state",void 0),(0,p.default)((0,u.default)(r),"currentCharset",void 0),(0,p.default)((0,u.default)(r),"socket",void 0),(0,p.default)((0,u.default)(r),"preventIdleHandler",void 0),(0,p.default)((0,u.default)(r),"getLine",(function(e){return r.term.state.getLine(e)})),r.config=S(S({},k.default),e),r.init(),r}return(0,l.default)(n,[{key:"line",get:function(){for(var e=[],t=0;t<this.term.state.rows;t++){var n=this.term.state.getLine(t),r=n.str,a=n.attr;e.push({str:r,attr:Object.assign({},a)})}return e}},{key:"screen",get:function(){return this.line.map((function(e){return e.str})).join("\n")}}]),(0,l.default)(n,[{key:"reconnect",value:function(){this.socket.connect()}},{key:"init",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,r,a=this;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,this.term=new v.default(t.terminal),this._state=S({},n.initialState),this.term.state.setMode("stringWidth","dbcs"),this.currentCharset="big5",e.t0=t.protocol.toLowerCase(),e.next="websocket"===e.t0||"ws"===e.t0||"wss"===e.t0?8:("telnet"===e.t0||e.t0,9);break;case 8:return e.abrupt("break",11);case 9:throw new Error("Invalid protocol: ".concat(t.protocol));case 11:(r=new y.default(t)).connect(),n.forwardEvents.forEach((function(e){r.on(e,a.emit.bind(a,e))})),r.on("connect",(function(){a._state.connect=!0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.emit.apply(a,["connect"].concat(t)),a.emit("stateChange",a.state)})).on("disconnect",(function(e){a._state.connect=!1,a._state.login=!1;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,["disconnect",e].concat(n)),a.emit("stateChange",a.state)})).on("message",(function(e){a.currentCharset!==a.config.charset&&!a.state.login&&(0,g.decode)(e,"utf8").includes("\u767b\u5165\u4e2d\uff0c\u8acb\u7a0d\u5019...")&&(a.currentCharset=a.config.charset);var t=(0,g.decode)(e,a.currentCharset);a.term.write(t),a.emit("redraw",a.term.toString())})).on("error",(function(e){})),this.socket=r;case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getContent",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,n,r,a,i,s;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=[]).push(this.line[0]),n=!1;case 3:if(this.line[23].str.includes("100%")||this.line[23].str.includes("\u6b64\u6587\u7ae0\u7121\u5167\u5bb9")){e.next=10;break}for(r=1;r<23;r++)t.push(this.line[r]);return e.next=7,this.send(g.keymap.PgDown);case 7:n=!0,e.next=3;break;case 10:a=t[t.length-1],i=0;case 12:if(!(i<23)){e.next=19;break}if(this.line[i].str!==a.str){e.next=16;break}for(s=i+1;s<23;s++)t.push(this.line[s]);return e.abrupt("break",19);case 16:i++,e.next=12;break;case 19:for(;t.length>0&&""===t[t.length-1].str;)t.pop();if(!n){e.next=23;break}return e.next=23,this.send(g.keymap.Home);case 23:return e.abrupt("return",t);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLines",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getContent();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.str})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;return this.config.preventIdleTimeout&&this.preventIdle(this.config.preventIdleTimeout),new Promise((function(n,r){var a,i=function(e){clearTimeout(a),n(!0)};t.state.connect?e.length>0?(t.socket.send((0,g.encode)(e,t.currentCharset)),t.once("message",i),a=setTimeout((function(){t.removeListener("message",i),n(!1)}),10*t.config.timeout)):(console.info("Sending message with 0-length. Skipped."),n(!0)):r()}))}},{key:"preventIdle",value:function(e){var t=this;clearTimeout(this.preventIdleHandler),this.state.login&&(this.preventIdleHandler=setTimeout((0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.send(g.keymap.CtrlU);case 2:return e.next=4,t.send(g.keymap.ArrowLeft);case 4:case"end":return e.stop()}}),e)}))),1e3*e))}},{key:"login",value:function(){var e=(0,s.default)(o.default.mark((function e(t,n){var r,a,i,s=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(s.length>2&&void 0!==s[2])||s[2],!this.state.login){e.next=3;break}return e.abrupt("return");case 3:return t=t.replace(/,/g,""),"utf8"===this.config.charset&&(t+=","),e.next=7,this.send("".concat(t).concat(g.keymap.Enter).concat(n).concat(g.keymap.Enter));case 7:return e.next=9,this.checkLogin(r);case 9:return(a=e.sent)&&((i=this._state).login=!0,i.position={boardname:""},this._state.username=t.substring(0,t.length-1),this.emit("stateChange",this.state)),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=(0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.login){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.send("G".concat(g.keymap.Enter,"Y").concat(g.keymap.Enter));case 4:return this._state.login=!1,this.emit("stateChange",this.state),this.send(g.keymap.Enter),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkLogin",value:function(){var e=(0,s.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.line[21].str.includes("\u5bc6\u78bc\u4e0d\u5c0d\u6216\u7121\u6b64\u5e33\u865f")&&!this.line[21].str.includes("\u8acb\u91cd\u65b0\u8f38\u5165")){e.next=5;break}return this.emit("login.failed"),e.abrupt("return",!1);case 5:if(!this.line[23].str.includes("\u8acb\u7a0d\u5f8c\u518d\u8a66")){e.next=10;break}return this.emit("login.failed"),e.abrupt("return",!1);case 10:if(!this.line[13].str.includes("\u4e82\u8e39\u5bc6\u78bc\u6703\u7559\u4e0b\u8a18\u9304\u5594")){e.next=15;break}return this.emit("login.failed"),e.abrupt("return",!1);case 15:n=0;case 16:return e.next=19,(0,b.default)(400);case 19:if(!(r=this.line)[22].str.includes("\u767b\u5165\u4e2d\uff0c\u8acb\u7a0d\u5019...")){e.next=23;break}e.next=64;break;case 23:if(!r[22].str.includes("\u60a8\u60f3\u522a\u9664\u5176\u4ed6\u91cd\u8907\u767b\u5165\u7684\u9023\u7dda\u55ce")){e.next=32;break}if(1!==n){e.next=26;break}return e.abrupt("continue",16);case 26:return e.next=28,this.send("".concat(t?"y":"n").concat(g.keymap.Enter));case 28:return n=1,e.abrupt("continue",16);case 32:if(!r[23].str.includes("\u8acb\u52ff\u983b\u7e41\u767b\u5165\u4ee5\u514d\u9020\u6210\u7cfb\u7d71\u904e\u5ea6\u8ca0\u8377")){e.next=40;break}if(2!==n){e.next=35;break}return e.abrupt("continue",16);case 35:return e.next=37,this.send("".concat(g.keymap.Enter));case 37:n=2,e.next=64;break;case 40:if(!r[23].str.includes("\u60a8\u8981\u522a\u9664\u4ee5\u4e0a\u932f\u8aa4\u5617\u8a66\u7684\u8a18\u9304\u55ce")){e.next=48;break}if(3!==n){e.next=43;break}return e.abrupt("continue",16);case 43:return e.next=45,this.send("y".concat(g.keymap.Enter));case 45:n=3,e.next=64;break;case 48:if(!r[23].str.includes("\u6309\u4efb\u610f\u9375\u7e7c\u7e8c")){e.next=53;break}return e.next=51,this.send("".concat(g.keymap.Enter));case 51:e.next=64;break;case 53:if(!(r[22].str+r[23].str).toLowerCase().includes("y/n")){e.next=59;break}return console.info("Unknown login state: \n".concat(this.screen)),e.next=57,this.send("y".concat(g.keymap.Enter));case 57:e.next=64;break;case 59:if(!r[23].str.includes("\u6211\u662f")){e.next=63;break}return e.abrupt("break",66);case 63:console.info("Unknown login state: \n".concat(this.screen));case 64:e.next=16;break;case 66:return this.emit("login.success"),e.abrupt("return",!0);case 68:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkArticleWithHeader",value:function(){return"\u4f5c\u8005"===(0,x.substrWidth)("dbcs",this.line[0].str,0,6).trim()}},{key:"select",value:function(e){return e.select(this)}},{key:"getMails",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,n,r,a,i,s,c=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:0,e.next=3,this.enterMail();case 3:if(!(t>0)){e.next=7;break}return t=Math.max(t-9,1),e.next=7,this.send("".concat(g.keymap.End).concat(g.keymap.End).concat(t).concat(g.keymap.Enter));case 7:for(n=this.getLine,r=[],a=3;a<=22;a++)i=n(a).str,s={sn:+(0,x.substrWidth)("dbcs",i,1,5).trim(),date:(0,x.substrWidth)("dbcs",i,9,5).trim(),author:(0,x.substrWidth)("dbcs",i,15,12).trim(),status:(0,x.substrWidth)("dbcs",i,30,2).trim(),title:(0,x.substrWidth)("dbcs",i,33).trim()},r.push(s);return e.next=12,this.enterIndex();case 12:return e.abrupt("return",r.reverse());case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMail",value:function(){var e=(0,s.default)(o.default.mark((function e(t){var n,r;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enterMail();case 2:return n=this.getLine,e.next=5,this.send("".concat(t).concat(g.keymap.Enter).concat(g.keymap.Enter));case 5:return this.checkArticleWithHeader(),r={sn:t,author:"",title:"",timestamp:"",lines:[]},this.checkArticleWithHeader()&&(r.author=(0,x.substrWidth)("dbcs",n(0).str,7,50).trim(),r.title=(0,x.substrWidth)("dbcs",n(1).str,7).trim(),r.timestamp=(0,x.substrWidth)("dbcs",n(2).str,7).trim()),e.next=10,this.getLines();case 10:return r.lines=e.sent,e.next=13,this.enterIndex();case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enterIndex",value:function(){var e=(0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send("".concat(g.keymap.ArrowLeft.repeat(10)));case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enterArticleByAIDFromBoard",value:function(){var e=(0,s.default)(o.default.mark((function e(t){var n;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.login){e.next=2;break}return e.abrupt("return",Promise.reject("not login"));case 2:return n="#".concat(t).concat(g.keymap.Enter),e.next=5,this.send(n);case 5:if(e.sent){e.next=10;break}return e.next=9,this.send("".concat(g.keymap.Enter));case 9:return e.abrupt("return",Promise.reject("enterArticleByAIDFromBoard failed"));case 10:return e.next=12,this.send("".concat(g.keymap.ArrowRight));case 12:return e.abrupt("return",Promise.resolve("now in article : ".concat(t)));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enterArticleByAID",value:function(){var e=(0,s.default)(o.default.mark((function e(t,n){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.login){e.next=2;break}return e.abrupt("return",Promise.reject("not login"));case 2:return e.prev=2,e.next=5,this.enterBoardByName(t);case 5:return e.next=7,this.enterArticleByAIDFromBoard(n);case 7:return e.abrupt("return",Promise.resolve("now in article : ".concat(n)));case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",Promise.reject(e.t0));case 13:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendComment",value:function(){var e=(0,s.default)(o.default.mark((function e(t){var n,r,a,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.login){e.next=2;break}return e.abrupt("return",Promise.reject("not login"));case 2:if(0!==(n=(n=t.text).trim()).length){e.next=6;break}return e.abrupt("return",Promise.reject("empty string"));case 6:return 52,n=function(e){for(var t=[],n="",r=0,a=0;r<e.length;)e[r]>="\xff"?a>=51?(t.push(n),n="",a=0):(n+=e[r],a+=2,r++):52==a?(t.push(n),n="",a=0):(n+=e[r],a+=1,r++);return t.push(n),t}(n),e.prev=9,e.next=12,this.enterBoardByName(t.boardName);case 12:r=E(n),e.prev=13,r.s();case 15:if((a=r.n()).done){e.next=31;break}return i=a.value,e.next=19,this.enterArticleByAIDFromBoard(t.aid);case 19:return e.next=21,this.send("X");case 21:if(!this.line[23].str.includes("\u60a8\u89ba\u5f97\u9019\u7bc7\u6587\u7ae0")){e.next=24;break}return e.next=24,this.send("".concat(t.type));case 24:if(!this.line[22].str.includes("\u4f7f\u7528 \u2192 \u52a0\u8a3b\u65b9\u5f0f")&&!this.line[23].str.includes(this.state.username)){e.next=29;break}return e.next=27,this.send("".concat(i).concat(g.keymap.Enter));case 27:return e.next=29,this.send("y".concat(g.keymap.Enter));case 29:e.next=15;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(13),r.e(e.t0);case 36:return e.prev=36,r.f(),e.finish(36);case 39:return e.next=41,this.enterIndex();case 41:return e.abrupt("return",Promise.resolve("comment success"));case 44:return e.prev=44,e.t1=e.catch(9),e.abrupt("return",Promise.reject(e.t1));case 47:case"end":return e.stop()}}),e,this,[[9,44],[13,33,36,39]])})));return function(t){return e.apply(this,arguments)}}()},{key:"enterBoardByName",value:function(){var e=(0,s.default)(o.default.mark((function e(t){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send("s".concat(t).concat(g.keymap.Enter," ").concat(g.keymap.Home).concat(g.keymap.End));case 2:if(this.currentBoardname.toLowerCase()!==t.toLowerCase()){e.next=8;break}return this._state.position.boardname=this.currentBoardname,this.emit("stateChange",this.state),e.abrupt("return",Promise.resolve("now in board : ".concat(t)));case 8:return e.next=10,this.enterIndex();case 10:return e.abrupt("return",Promise.reject("enterBoardByName failed"));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enterByOffset",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,n,r=this,a=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:[],n=!0,t.forEach(function(){var e=(0,s.default)(o.default.mark((function e(t){var a,i;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===t&&(n=!1),!(t<0)){e.next=15;break}a=22;case 3:if(!(a>=3)){e.next=15;break}if(!((i=(0,x.substrWidth)("dbcs",r.line[a].str,3,4).trim()).length>0)){e.next=8;break}return t+=+i+1,e.abrupt("break",15);case 8:if(!((i=(0,x.substrWidth)("dbcs",r.line[a].str,15,2).trim()).length>0)){e.next=12;break}return t+=+i+1,e.abrupt("break",15);case 12:a--,e.next=3;break;case 15:if(t<0&&(n=!1),n){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,r.send("".concat(t).concat(g.keymap.Enter.repeat(2)," ").concat(g.keymap.Home).concat(g.keymap.End));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),!n){e.next=11;break}return this._state.position.boardname=this.currentBoardname,this.emit("stateChange",this.state),e.next=8,this.send(g.keymap.Home);case 8:return e.abrupt("return",!0);case 11:return e.next=13,this.enterIndex();case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enterBoardByOffset",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,n=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],e.next=3,this.send("C".concat(g.keymap.Enter));case 3:return e.next=5,this.enterByOffset(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enterFavorite",value:function(){var e=(0,s.default)(o.default.mark((function e(){var t,n=arguments;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:[],e.next=3,this.send("F".concat(g.keymap.Enter));case 3:return e.next=5,this.enterByOffset(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enterMail",value:function(){var e=(0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send("M".concat(g.keymap.Enter,"R").concat(g.keymap.Enter).concat(g.keymap.Home).concat(g.keymap.End));case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"state",get:function(){return S({},this._state)}},{key:"currentBoardname",get:function(){var e=w(/\u3010(?!\u770B\u677F\u5217\u8868).*\u3011.*\u300A(.*)\u300B/,{boardname:1}).exec(this.line[0].str);return e?e.groups.boardname:void 0}}]),n}(m.default);(0,p.default)(C,"initialState",{connect:!1,login:!1}),(0,p.default)(C,"forwardEvents",["message","error"]);var _=C;t.default=_},198:function(e,t){},200:function(e,t){},226:function(e,t,n){"use strict";(function(e){var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n(113)),i=n(136),o=function(t,n){var r="";switch(n){case"utf8":case"utf-8":r=e.from(t).toString("utf8");break;case"big5":r=(0,i.decodeSync)(String.fromCharCode.apply(String,(0,a.default)(t)));break;default:throw new TypeError("Unknown charset: ".concat(n))}return r};t.default=o}).call(this,n(53).Buffer)},227:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(136),a=function(t,n){var a;switch(n){case"utf8":case"utf-8":a=e.from(t,"utf8");break;case"big5":a=e.from((0,r.encodeSync)(t),"binary");break;default:throw new TypeError("Unknown charset: ".concat(n))}return a};t.default=a}).call(this,n(53).Buffer)},228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={Enter:"\r",ArrowLeft:"\x1b[D",ArrowRight:"\x1b[C",ArrowUp:"\x1b[A",ArrowDown:"\x1b[B",PgUp:"\x1b[5~",PgDown:"\x1b[6~",Home:"\x1b[1~",End:"\x1b[4~",Backspace:"\b",CtrlC:"\x03",CtrlP:"\x10",CtrlU:"\x15",CtrlZ:"\x1a"}},229:function(e,t,n){},234:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ArticleSelectQueryBuilder=t.WhereType=t.Article=void 0;var a=r(n(80)),i=r(n(81)),o=r(n(50)),s=r(n(51)),c=r(n(52)),u=r(n(40)),l=r(n(41)),f=r(n(68)),d=r(n(69)),h=n(114),p=n(84),m=n(85);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}var v,y=function(){function e(){(0,l.default)(this,e),(0,d.default)(this,"boardname",void 0),(0,d.default)(this,"id",void 0),(0,d.default)(this,"push",void 0),(0,d.default)(this,"date",void 0),(0,d.default)(this,"timestamp",void 0),(0,d.default)(this,"author",void 0),(0,d.default)(this,"status",void 0),(0,d.default)(this,"title",void 0),(0,d.default)(this,"fixed",void 0),(0,d.default)(this,"_content",[])}return(0,f.default)(e,[{key:"content",get:function(){return this._content},set:function(e){this._content=e.slice()}},{key:"data",get:function(){return this._content.map((function(e){return e.str}))},set:function(e){console.warn("Should not set Mail.data/Mail.lines directly. Use Mail.content instead")}}]),(0,f.default)(e,[{key:"hasHeader",value:function(){return 0!==this.content.length&&"\u4f5c\u8005"===(0,m.substrWidth)("dbcs",this.content[0].str,0,6).trim()}}],[{key:"fromLine",value:function(t){var n=new e,r=t.str;return n.id=+(0,m.substrWidth)("dbcs",r,1,7).trim(),n.push=(0,m.substrWidth)("dbcs",r,9,2).trim(),n.date=(0,m.substrWidth)("dbcs",r,11,5).trim(),n.author=(0,m.substrWidth)("dbcs",r,17,12).trim(),n.status=(0,m.substrWidth)("dbcs",r,30,2).trim(),n.title=(0,m.substrWidth)("dbcs",r,32).trim(),n.fixed=(0,m.substrWidth)("dbcs",r,1,7).trim().includes("\u2605"),n}},{key:"select",value:function(e){return new g(e)}}]),e}();t.Article=y,t.WhereType=v,function(e){e.Boardname="boardname",e.Id="id",e.Push="push",e.Author="author",e.Title="title"}(v||(t.WhereType=v={}));var g=function(e){(0,s.default)(n,e);var t=b(n);function n(e){var r;return(0,l.default)(this,n),r=t.call(this),(0,d.default)((0,o.default)(r),"bot",void 0),(0,d.default)((0,o.default)(r),"boardname",""),(0,d.default)((0,o.default)(r),"wheres",[]),(0,d.default)((0,o.default)(r),"id",0),r.bot=e,r}return(0,f.default)(n,[{key:"where",value:function(e,t){switch(e){case v.Boardname:""!==this.boardname?console.warn('Cannot call where with type "'.concat(e,'" multiple times')):this.boardname=t;break;case v.Id:this.id=+t;break;case v.Push:this.wheres.push({type:"Z",condition:t});break;case v.Author:this.wheres.push({type:"a",condition:t});break;case v.Title:this.wheres.push({type:"/",condition:t});break;default:throw new Error("Invalid type: ".concat(e))}return this}},{key:"getQuery",value:function(){return this.wheres.map((function(e){var t=e.type,n=e.condition;return"".concat(t).concat(n).concat(p.keymap.Enter)})).join()}},{key:"get",value:function(){var e=(0,i.default)(a.default.mark((function e(){var t,n,r,i,o,s,c;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.enterBoardByName(this.boardname);case 2:return e.next=4,this.bot.send(this.getQuery());case 4:if(e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(!(this.id>0)){e.next=11;break}return t=Math.max(this.id-9,1),e.next=11,this.bot.send("".concat(p.keymap.End).concat(p.keymap.End).concat(t).concat(p.keymap.Enter));case 11:n=[],r=3;case 13:if(!(r<=22)){e.next=23;break}if(""!==(i=this.bot.line[r]).str.trim()){e.next=17;break}return e.abrupt("break",23);case 17:(o=y.fromLine(i)).boardname=this.boardname,n.push(o);case 20:r++,e.next=13;break;case 23:if(!(n.length>=2&&0===n[0].id)){e.next=32;break}s=1;case 25:if(!(s<n.length)){e.next=32;break}if(0===n[s].id){e.next=29;break}return n[0].id=n[s].id-s,e.abrupt("break",32);case 29:s++,e.next=25;break;case 32:for(c=1;c<n.length;c++)n[c].id=n[c-1].id+1;return e.next=35,this.bot.enterIndex();case 35:return e.abrupt("return",n.reverse());case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOne",value:function(){var e=(0,i.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.enterBoardByName(this.boardname);case 2:return e.next=4,this.bot.send(this.getQuery());case 4:if(e.sent){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.next=9,this.bot.send("".concat(this.id).concat(p.keymap.Enter).concat(p.keymap.Enter));case 9:return(t=new y).id=this.id,t.boardname=this.boardname,e.next=14,this.bot.getContent();case 14:return t.content=e.sent,t.hasHeader()&&(t.author=(0,m.substrWidth)("dbcs",this.bot.line[0].str,7,50).trim(),t.title=(0,m.substrWidth)("dbcs",this.bot.line[1].str,7).trim(),t.timestamp=(0,m.substrWidth)("dbcs",this.bot.line[2].str,7).trim()),e.next=18,this.bot.enterIndex();case 18:return e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(h.SelectQueryBuilder);t.ArticleSelectQueryBuilder=g;var x=y;t.default=x},235:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.QueryBuilder=void 0;var a=r(n(41));t.QueryBuilder=function e(){(0,a.default)(this,e)}},236:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.BoardSelectQueryBuilder=t.Entry=t.WhereType=t.Board=void 0;var a=r(n(80)),i=r(n(113)),o=r(n(81)),s=r(n(50)),c=r(n(51)),u=r(n(52)),l=r(n(40)),f=r(n(41)),d=r(n(68)),h=r(n(69)),p=n(114),m=n(84),b=n(85);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var a=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var y,g,x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";(0,f.default)(this,e),(0,h.default)(this,"name",""),(0,h.default)(this,"id",0),(0,h.default)(this,"unread",!1),(0,h.default)(this,"category",""),(0,h.default)(this,"flag",""),(0,h.default)(this,"title",""),(0,h.default)(this,"users",""),(0,h.default)(this,"admin",""),(0,h.default)(this,"folder",!1),(0,h.default)(this,"divider",!1),this.name=t}return(0,d.default)(e,null,[{key:"fromLine",value:function(t){var n=new e,r=t.str;switch(n.id=+(0,b.substrWidth)("dbcs",r,3,4).trim(),n.unread="\u02c7"===(0,b.substrWidth)("dbcs",r,8,2).trim(),n.name=(0,b.substrWidth)("dbcs",r,10,12).trim(),n.category=(0,b.substrWidth)("dbcs",r,23,4).trim(),n.flag=(0,b.substrWidth)("dbcs",r,28,2).trim(),n.flag){case"\u25a1":n.title=(0,b.substrWidth)("dbcs",r,30).replace(/\s+$/,""),n.folder=!0;break;case"--":n.divider=!0;break;case"\u03a3":n.title=(0,b.substrWidth)("dbcs",r,30,31).replace(/\s+$/,""),n.users=(0,b.substrWidth)("dbcs",r,62,5).trim(),n.admin=(0,b.substrWidth)("dbcs",r,67).trim(),n.folder=!0;break;case"\u25ce":n.title=(0,b.substrWidth)("dbcs",r,30,31).replace(/\s+$/,""),n.users=(0,b.substrWidth)("dbcs",r,62,5).trim(),n.admin=(0,b.substrWidth)("dbcs",r,67).trim();break;default:console.warn('Unknown board flag. line.str: "'.concat(r,'"'))}return n}},{key:"fromClassLine",value:function(t){var n=new e,r=t.str;return n.id=+(0,b.substrWidth)("dbcs",r,15,2),n.title=(0,b.substrWidth)("dbcs",r,20,29).replace(/\s+$/,""),n.admin=(0,b.substrWidth)("dbcs",r,61).trim(),n.folder=!0,n}},{key:"select",value:function(e){return new k(e)}}]),e}();t.Board=x,t.WhereType=y,function(e){e.Entry="entry",e.Prefix="prefix",e.Offset="offset",e.Offsets="offsets"}(y||(t.WhereType=y={})),t.Entry=g,function(e){e.Class="class",e.Favorite="favorite",e.Hot="hot"}(g||(t.Entry=g={}));var k=function(e){(0,c.default)(n,e);var t=v(n);function n(e){var r;return(0,f.default)(this,n),r=t.call(this),(0,h.default)((0,s.default)(r),"bot",void 0),(0,h.default)((0,s.default)(r),"entry",g.Class),(0,h.default)((0,s.default)(r),"prefix",""),(0,h.default)((0,s.default)(r),"offsets",[]),r.bot=e,r}return(0,d.default)(n,[{key:"where",value:function(e,t){switch(e.toLowerCase()){case y.Entry:this.entry=t.toLowerCase();break;case y.Prefix:this.prefix=t;break;case y.Offset:this.offsets.push(t);break;case y.Offsets:this.offsets=t.slice();break;default:throw new Error("Invalid type: ".concat(e))}return this}},{key:"get",value:function(){var e=(0,o.default)(a.default.mark((function e(){var t,n,r,o,s,c,u,l,f;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===this.prefix){e.next=4;break}return e.next=3,this.getByPrefix(this.prefix);case 3:return e.abrupt("return",e.sent);case 4:e.t0=this.entry,e.next=e.t0===g.Class?7:e.t0===g.Favorite?11:e.t0===g.Hot?15:19;break;case 7:return e.next=9,this.bot.enterBoardByOffset(this.offsets);case 9:return t=e.sent,e.abrupt("break",19);case 11:return e.next=13,this.bot.enterFavorite(this.offsets);case 13:return t=e.sent,e.abrupt("break",19);case 15:return e.next=17,this.bot.enterBoardByOffset([-1].concat((0,i.default)(this.offsets)));case 17:return t=e.sent,e.abrupt("break",19);case 19:if(n=[],!t){e.next=56;break}if(this.entry!==g.Class||0!==this.offsets.length){e.next=34;break}r=7;case 23:if(!(r<23)){e.next=32;break}if(""!==(o=this.bot.line[r]).str.trim()){e.next=27;break}return e.abrupt("break",32);case 27:s=x.fromClassLine(o),n.push(s);case 29:r++,e.next=23;break;case 32:e.next=56;break;case 34:0,c=!1,u=3;case 37:if(!(u<23)){e.next=50;break}if(""!==(l=this.bot.line[u]).str.trim()){e.next=42;break}return c=!0,e.abrupt("break",50);case 42:if((f=x.fromLine(l)).id===n.length+1){e.next=46;break}return c=!0,e.abrupt("break",50);case 46:n.push(f);case 47:u++,e.next=37;break;case 50:if(!c){e.next=52;break}return e.abrupt("break",56);case 52:return e.next=54,this.bot.send(m.keymap.PgDown);case 54:e.next=34;break;case 56:return e.next=58,this.bot.enterIndex();case 58:return e.abrupt("return",n);case 59:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOne",value:function(){var e=(0,o.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get();case 2:return t=e.sent,e.abrupt("return",t.length?t[0]:void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getByPrefix",value:function(){var e=(0,o.default)(a.default.mark((function e(t){var n,r,i,o,s,c,u,l,f;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.send("s".concat(t," "));case 2:if(n=[],0!==(r=this.bot.line[3].str).toLowerCase().indexOf(t.toLowerCase())){e.next=27;break}for(i=0,o=0,s=15;s<r.length&&" "!==r[s];)s+=1;for(;s<r.length&&" "===r[s];)s+=1;case 9:if(c=this.bot.line[o+3],""===(u=(0,b.substrWidth)("dbcs",c.str,i*s,s).trim())){e.next=16;break}n.push(new x(u)),e.next=17;break;case 16:return e.abrupt("break",25);case 17:if(20!=(o+=1)){e.next=23;break}if(o=0,!(((i+=1)+1)*s>80)){e.next=23;break}return e.abrupt("break",25);case 23:e.next=9;break;case 25:e.next=30;break;case 27:l=this.bot.line[1].str,0===(f=(0,b.substrWidth)("dbcs",l,34,15).trim()).toLowerCase().indexOf(t.toLowerCase())&&n.push(new x(f));case 30:return e.next=32,this.bot.send(m.keymap.CtrlC);case 32:return e.abrupt("return",n);case 33:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(p.SelectQueryBuilder);t.BoardSelectQueryBuilder=k;var w=x;t.default=w},237:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MailSelectQueryBuilder=t.WhereType=t.Mail=void 0;var a=r(n(80)),i=r(n(81)),o=r(n(50)),s=r(n(51)),c=r(n(52)),u=r(n(40)),l=r(n(41)),f=r(n(68)),d=r(n(69)),h=n(114),p=n(84),m=n(85);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.default)(this,n)}}var v,y=function(){function e(){(0,l.default)(this,e),(0,d.default)(this,"id",void 0),(0,d.default)(this,"date",void 0),(0,d.default)(this,"timestamp",void 0),(0,d.default)(this,"author",void 0),(0,d.default)(this,"status",void 0),(0,d.default)(this,"title",void 0),(0,d.default)(this,"_content",[])}return(0,f.default)(e,[{key:"content",get:function(){return this._content},set:function(e){this._content=e.slice()}},{key:"data",get:function(){return this._content.map((function(e){return e.str}))},set:function(e){console.warn("Should not set Mail.data/Mail.lines directly. Use Mail.content instead")}}]),(0,f.default)(e,[{key:"hasHeader",value:function(){return 0!==this.content.length&&"\u4f5c\u8005"===(0,m.substrWidth)("dbcs",this.content[0].str,0,6).trim()}}],[{key:"fromLine",value:function(t){var n=new e,r=t.str;return n.id=+(0,m.substrWidth)("dbcs",r,1,5).trim(),n.date=(0,m.substrWidth)("dbcs",r,9,5).trim(),n.author=(0,m.substrWidth)("dbcs",r,15,12).trim(),n.status=(0,m.substrWidth)("dbcs",r,30,2).trim(),n.title=(0,m.substrWidth)("dbcs",r,33).trim(),n}},{key:"select",value:function(e){return new g(e)}}]),e}();t.Mail=y,t.WhereType=v,function(e){e.Id="id",e.Author="author",e.Title="title"}(v||(t.WhereType=v={}));var g=function(e){(0,s.default)(n,e);var t=b(n);function n(e){var r;return(0,l.default)(this,n),r=t.call(this),(0,d.default)((0,o.default)(r),"bot",void 0),(0,d.default)((0,o.default)(r),"wheres",[]),(0,d.default)((0,o.default)(r),"id",0),r.bot=e,r}return(0,f.default)(n,[{key:"where",value:function(e,t){switch(e){case v.Id:this.id=+t;break;case v.Author:this.wheres.push({type:"a",condition:t});break;case v.Title:this.wheres.push({type:"/",condition:t});break;default:throw new Error("Invalid type: ".concat(e))}return this}},{key:"getQuery",value:function(){return this.wheres.map((function(e){var t=e.type,n=e.condition;return"".concat(t).concat(n).concat(p.keymap.Enter)})).join()}},{key:"get",value:function(){var e=(0,i.default)(a.default.mark((function e(){var t,n,r,i,o;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.enterMail();case 2:return e.next=4,this.bot.send(this.getQuery());case 4:if(e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(!(this.id>0)){e.next=11;break}return t=Math.max(this.id-9,1),e.next=11,this.bot.send("".concat(p.keymap.End).concat(p.keymap.End).concat(t).concat(p.keymap.Enter));case 11:n=[],r=3;case 13:if(!(r<=22)){e.next=22;break}if(""!==(i=this.bot.line[r]).str.trim()){e.next=17;break}return e.abrupt("break",22);case 17:o=y.fromLine(i),n.push(o);case 19:r++,e.next=13;break;case 22:return e.next=24,this.bot.enterIndex();case 24:return e.abrupt("return",n.reverse());case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOne",value:function(){var e=(0,i.default)(a.default.mark((function e(){var t;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.enterMail();case 2:return e.next=4,this.bot.send(this.getQuery());case 4:if(e.sent){e.next=7;break}return e.abrupt("return",void 0);case 7:return e.next=9,this.bot.send("".concat(this.id).concat(p.keymap.Enter).concat(p.keymap.Enter));case 9:return(t=new y).id=this.id,e.next=13,this.bot.getContent();case 13:return t.content=e.sent,t.hasHeader()&&(t.author=(0,m.substrWidth)("dbcs",this.bot.line[0].str,7,50).trim(),t.title=(0,m.substrWidth)("dbcs",this.bot.line[1].str,7).trim(),t.timestamp=(0,m.substrWidth)("dbcs",this.bot.line[2].str,7).trim()),e.next=17,this.bot.enterIndex();case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(h.SelectQueryBuilder);t.MailSelectQueryBuilder=g;var x=y;t.default=x},258:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(13),o=n.n(i),s=(n(179),n(146)),c=n(147),u=n(158),l=n(159),f=n(301),d=n(8),h=n(6),p=n.n(h),m=n(11),b=n(306),v=n(305),y=n(330),g=n(312),x=n(327),k=n(303),w=n(76),E=n(298),O=n(329),j=n(97),S=n(35),B=new j.a,C=Object(S.a)((function(){var e=Object(r.useState)(B.get("user")),t=Object(d.a)(e,2);return{user:t[0],setUser:t[1]}})),_=Object(d.a)(C,2),T=_[0],L=_[1],P=n(87),W=n(148),N=n.n(W);var I=Object(S.a)((function(){var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)({severity:"",text:""}),o=Object(d.a)(i,2);return{isSnackbarOpen:n,setIsSnackbarOpen:a,snackbarContent:o[0],setSnackbarContent:o[1]}})),R=Object(d.a)(I,2),M=R[0],A=R[1],D=Object(S.a)((function(){console.log("new useBot()");var e=Object(r.useState)(new N.a),t=Object(d.a)(e,1)[0],n=Object(r.useState)(t.state),a=Object(d.a)(n,2),i=a[0],o=a[1],s=function(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e})),t.current}(i),c=A(),u=c.setIsSnackbarOpen,l=c.setSnackbarContent;t.on("connect",(function(){console.log("bot connected"),o(t.state)})),t.on("disconnect",(function(){console.log("bot disconnected"),o(t.state)}));var f=!1,h=function(){var e=Object(m.a)(p.a.mark((function e(n){var r,a,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.username,a=n.password,e.next=3,t.login(r,a,!0);case 3:return(s=e.sent)&&o(Object(P.a)({},i,{login:!0})),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(m.a)(p.a.mark((function e(n){var r,a,o,s,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=4;break}return l({severity:"info",text:"\u7b49\uff01"}),u(!0),e.abrupt("return",Promise.reject("bot is busy!"));case 4:if(f=!0,console.log("bot command : ",n),e.prev=6,i.connect){e.next=9;break}return e.abrupt("return",Promise.reject("not login!"));case 9:if("login"!==n.type){e.next=18;break}if(!i.login){e.next=13;break}return e.abrupt("return",!0);case 13:return e.next=15,h(n.arg);case 15:return r=e.sent,f=!1,e.abrupt("return",r);case 18:if("select"!==n.type){e.next=27;break}if(i.login){e.next=21;break}return e.abrupt("return",!1);case 21:return a=n.arg,e.next=24,a.get();case 24:return o=e.sent,f=!1,e.abrupt("return",o);case 27:if("content"!==n.type){e.next=36;break}if(i.login){e.next=30;break}return e.abrupt("return",!1);case 30:return s=n.arg,e.next=33,s.getOne();case 33:return c=e.sent,f=!1,e.abrupt("return",c);case 36:if("comment"!==n.type){e.next=43;break}if(i.login){e.next=39;break}return e.abrupt("return",!1);case 39:return e.next=41,t.sendComment(n.arg);case 41:return f=!1,e.abrupt("return",!0);case 43:e.next=49;break;case 45:return e.prev=45,e.t0=e.catch(6),f=!1,e.abrupt("return",Promise.reject(e.t0));case 49:case"end":return e.stop()}}),e,null,[[6,45]])})));return function(t){return e.apply(this,arguments)}}();return{bot:t,botState:i,prevBotState:s,setBotState:o,executeCommand:b}})),H=Object(d.a)(D,2),Y=H[0],z=H[1],F=n(304),Q=n(65),U=Object(E.a)((function(e){return{root:{justifyContent:"center",alignItems:"center",flexDirection:"column"},paperform:{width:"400px",margin:e.spacing(8,4),display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},paperlogging:{minWidth:"12vw",height:"9vh",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",marginTop:"25vh",zIndex:e.zIndex.drawer+2},paperreconnect:{padding:"12px",minWidth:"20vw",height:"15vh",display:"flex",flexDirection:"column"},reconnectText:{},reconnectButton:{alignSelf:"flex-end"},form:{width:"80%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},signin:{marginTop:e.spacing(2)},backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"},circle:{marginRight:"9px"}}}));function $(){var e=U(),t=L(),n=t.user,i=t.setUser,o=z(),s=A(),c=s.setIsSnackbarOpen,u=s.setSnackbarContent,l=Object(Q.b)(),h=l.register,E=l.handleSubmit,S=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r={username:t.username,password:t.password},e.next=4,B(r);case 4:e.sent&&((new j.a).set("user",r),i(r));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),B=Object(r.useCallback)(function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),Y(!1),R(!0),e.next=5,o.executeCommand({type:"login",arg:t});case 5:if(!e.sent){e.next=13;break}return console.log("login success"),P(!1),R(!1),e.abrupt("return",!0);case 13:return console.log("login fail"),u({severity:"error",text:"\u5e33\u5bc6\u8f38\u5165\u932f\u8aa4\uff01\uff01"}),c(!0),Y(!0),R(!1),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[o]),C=Object(r.useState)(!n),_=Object(d.a)(C,2),T=_[0],P=_[1],W=Object(r.useState)(!1),N=Object(d.a)(W,2),I=N[0],R=N[1],M=Object(r.useState)(!0),D=Object(d.a)(M,2),H=D[0],Y=D[1],$=Object(r.useState)(!1),G=Object(d.a)($,2),q=G[0],V=G[1];return Object(r.useEffect)((function(){function e(){return(e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}if(console.log("botState:",o.botState),console.log("prev botState:",o.prevBotState),n){if(void 0===o.prevBotState)return;o.botState.connect&&!o.prevBotState.connect?(V(!1),function(){e.apply(this,arguments)}()):o.prevBotState.connect&&!o.botState.connect&&(P(!0),V(!0))}}),[n,o.botState,o.prevBotState,B]),a.a.createElement(f.a,{container:!0,component:"main",className:e.root},I&&a.a.createElement(k.a,{className:e.paperlogging},a.a.createElement(F.a,{className:e.circle,color:"secondary"}),a.a.createElement(w.a,{variant:"body1"},o.connect?o.login?"":"\u767b\u5165\u4e2d":"\u9023\u7dda\u4e2d")),a.a.createElement(O.a,{className:e.backdrop,open:T},a.a.createElement(f.a,{container:!0,component:"main",className:e.root},a.a.createElement(v.a,null),q&&a.a.createElement(k.a,{className:e.paperreconnect},a.a.createElement(w.a,{variant:"body1",className:e.reconnectText},"\u60a8\u65b7\u7dda\u4e86"),a.a.createElement(b.a,{variant:"contained",color:"secondary",className:e.reconnectButton,onClick:function(){o.bot.reconnect()}},"\u91cd\u65b0\u9023\u7dda")),H&&a.a.createElement(k.a,{className:e.paperform},a.a.createElement(w.a,{component:"h4",variant:"h5",className:e.signin},"\u767b\u5165PTT"),a.a.createElement("form",{className:e.form,onSubmit:E(S)},a.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"\u5e33\u865f",name:"username",autoComplete:"username",autoFocus:!0,inputRef:h}),a.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"\u5bc6\u78bc",type:"password",id:"password",autoComplete:"current-password",inputRef:h}),a.a.createElement(g.a,{control:a.a.createElement(x.a,{value:"remember",color:"primary"}),label:"\u8a18\u4f4f\u6211"}),a.a.createElement(b.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:e.submit},"\u767b\u5165"))))))}n(152);var G=n(44),q=n.n(G),V=n(311),J=n(259),X=n(315),Z=n(314),K=n(95),ee=n.n(K),te=n(32);function ne(e){var t=e.item,n=e.info,r=e.BotContext,i=function(){var e=Object(m.a)(p.a.mark((function e(){var a,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("boardItem click",t,n,r),e.prev=1,a=r.bot.select(te.Article).where("boardname",t.name),e.next=5,r.executeCommand({type:"select",arg:a});case 5:i=e.sent,console.log("handleclick",i),n.setIndex(0),n.setArticleList(i),n.setBoardName(t.name),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}}();return a.a.createElement(J.a,{button:!0,onClick:i,key:t.name,style:{height:"10vh"}},a.a.createElement(Z.a,{primary:a.a.createElement(w.a,{variant:"body1"},t.name),secondary:a.a.createElement(w.a,{variant:"body2"},t.title)}),a.a.createElement(X.a,{style:{justifyContent:"center"}},a.a.createElement(ee.a,null)))}function re(e){for(var t,n=Number(e),r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_",a=r.length,i="";n;)n-=t=n%a,n/=a,i=r.charAt(t)+i;return i}function ae(e){console.log(e);var t=e.split("/").filter((function(e){return e}));if(5!==t.length||"www.ptt.cc"!==t[1])return"";var n=t[3],r=t[4].split(".");if(5!==r.length)return"";var a=r[1],i=r[3],o=re(a),s=re(parseInt(i,16));return 1===s.length&&(s="0"+s),[n,o+s]}var ie=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r={info:{id:"",aid:"",author:"",boardname:"",timestamp:"",commentStartIndex:-1,title:"",ip:""},content:[],comment:[]}).info.boardname=t.boardname,r.info.id=t.id,e.next=6,oe(n,r);case 6:return a=e.sent,r.info.aid="",r.info.author=a.author,r.info.timestamp=a.timestamp,r.info.commentStartIndex=-1,r.info.title=a.title,r.info.ip="",r.content=[],r.comment=[],se(a,r),ce(a,r),e.abrupt("return",r);case 20:return e.prev=20,e.t0=e.catch(0),e.abrupt("return",Promise.reject(e.t0));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(t,n){return e.apply(this,arguments)}}(),oe=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.bot.select(te.Article).where("boardname",n.info.boardname).where("id",n.info.id),e.next=3,t.executeCommand({type:"content",arg:r});case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",Promise.reject("getArticleResponse err."));case 6:return console.log(a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),se=function(e,t){for(var n=e.content,r=4;r<n.length;r++){var a=n[r].str;if(a.startsWith("\u203b \u767c\u4fe1\u7ad9: \u6279\u8e22\u8e22\u5be6\u696d\u574a(ptt.cc)")){t.info.ip=a.substring(27);var i=n[++r].str,o=ae(i.substring(i.indexOf(":")+2)),s=Object(d.a)(o,2),c=(s[0],s[1]);t.info.aid=c,t.info.commentStartIndex=r+1;break}t.content.push(a)}},ce=function(e,t){if(-1!==t.info.commentStartIndex){var n=e.content;t.comment=[];for(var r=t.info.commentStartIndex,a=1;r<n.length;r++){var i=n[r].str,o={type:"",author:"",text:"",timestamp:""};if(i.match(/[\u63a8\u5653\u2192]\s+[\w\d]+\s*:.+/)){o.floor=a++,o.type=i[0],o.timestamp=i.substring(i.length-11);var s=i.indexOf(":");o.author=i.substring(2,s),o.text=i.substring(s+1,i.length-11)}else o.text=i;t.comment.push(o)}}},ue=function(){var e=Object(m.a)(p.a.mark((function e(t,n){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t,n);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",Promise.reject("refreshArticleComment err"));case 5:return ce(r,n),console.log("refresh",n.comment),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),le=Object(S.a)((function(){z();var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],i=new r.useState({info:{id:"",aid:"",author:"",boardname:"",timestamp:"",commentStartIndex:-1,title:"",ip:""},content:[],comment:[]}),o=Object(d.a)(i,2),s=o[0],c=o[1],u=Object(r.useState)([]),l=Object(d.a)(u,2),f=l[0],h=l[1],p=Object(r.useState)(0),m=Object(d.a)(p,2);return{boardName:n,setBoardName:a,articleContent:s,setArticleContent:c,articleList:f,setArticleList:h,index:m[0],setIndex:m[1]}})),fe=Object(d.a)(le,2),de=fe[0],he=fe[1];function pe(e){var t=Object(E.a)((function(e){return{root:{alignItems:"center",justifyContent:"center",maxHeight:"80vh",height:"80vh",overflow:"auto",alignContent:"flex-start"},skeleton:{fontSize:"40px",width:"80%"},list:{padding:"0px",width:"100%"}}}))(),n=L().user,i=z(),o=Object(r.useState)([]),s=Object(d.a)(o,2),c=s[0],u=s[1],l=he(),h=Object(r.useRef)(null),b=Object(r.useRef)(null),v=Object(r.useRef)({}),y=e.selectedBoard,g=e.searchBoardText,x=Object(r.useCallback)(Object(m.a)(p.a.mark((function e(){var t,n,r,a,o,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("searchCache",v),g.length>0?v.current[g]?t=v.current[g]:n=i.bot.select(te.Board).where("prefix",g):"hot"===y&&h.current?(t=h.current,console.log("hot cache",h)):"favorite"===y&&b.current?t=b.current:n="hot"===y?i.bot.select(te.Board).where("entry","hot"):i.bot.select(te.Board).where("entry","favorite"),t){e.next=16;break}return r=performance.now(),e.next=6,i.executeCommand({type:"select",arg:n});case 6:if(a=e.sent,o=performance.now(),console.log("bot select board",o-r),a){e.next=11;break}return e.abrupt("return",!1);case 11:console.log(a),t=a.map((function(e){return ne({item:e,info:l,BotContext:i})})),s=performance.now(),console.log("map boardItem",s-o),0===g.length?"hot"===y?h.current=t:"favorite"===y&&(b.current=t):v.current[g]=t;case 16:u(t);case 17:case"end":return e.stop()}}),e)}))),[i,u,y,l,g]);return Object(r.useEffect)((function(){function e(){return(e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i.botState.login&&(console.log(y),function(){e.apply(this,arguments)}())}),[i.botState.login,y,g]),a.a.createElement(f.a,{container:!0,component:"main",className:t.root},a.a.createElement(f.a,{item:!0,className:t.skeleton},0===g.length&&0===c.length&&a.a.createElement(q.a,{count:6})),c&&a.a.createElement(V.a,{className:t.list}," ",c," "),!c&&"")}var me=n(324),be=n(316),ve=n(313),ye=n(96),ge=n.n(ye),xe=n(161),ke=n(317);function we(e){var t=Object(E.a)((function(e){return{skeleton:{fontSize:"24px",width:"80%"},root:{justifyContent:"center",alignItems:"center"},select:{display:"flex",flexDirection:"column",width:"100%"},tabs:{flexBasis:"85%"},tab:{fontSize:"0.8rem",minWidth:"50%"},searchBotton:{flexBasis:"15%"},btntabs:{width:"100%",display:"flex"},inputbase:{}}}))(),n=z(),i=Object(r.useState)(0),o=Object(d.a)(i,2),s=o[0],c=o[1],u=Object(r.useState)(!1),l=Object(d.a)(u,2),h=l[0],p=l[1],m=e.setSelectedBoard,b=e.setSearchBoardText;return Object(r.useEffect)((function(){var e="hot";switch(s){case 0:e="hot";break;case 1:e="favorite"}m(e)}),[s,m]),a.a.createElement(f.a,{container:!0,component:"main",className:t.root},a.a.createElement(f.a,{item:!0,className:t.skeleton},!n.botState.login&&a.a.createElement(q.a,{count:1})),n.botState.login&&a.a.createElement(f.a,{item:!0,className:t.select},a.a.createElement(f.a,{item:!0,className:t.btntabs},a.a.createElement(ve.a,{color:"primary","aria-label":"search board",className:t.searchBotton,onClick:function(){p((function(e){return!e}))}},a.a.createElement(ge.a,null)),a.a.createElement(me.a,{value:s,indicatorColor:"primary",textColor:"primary",onChange:function(e,t){c(t)},className:t.tabs,variant:"scrollable"},a.a.createElement(be.a,{wrapped:!0,label:"\u71b1\u9580\u770b\u677f",className:t.tab}),a.a.createElement(be.a,{wrapped:!0,label:"\u6700\u611b\u770b\u677f",className:t.tab}))),a.a.createElement(ke.a,{in:h},a.a.createElement(xe.a,{onChange:function(e){console.log(e.target.value),b(e.target.value)},placeholder:"\u641c\u5c0b\u770b\u677f",className:t.inputbase}))))}function Ee(){var e=Object(E.a)((function(e){return{root:{position:"relative",display:"flex",borderRight:"1px solid ".concat(e.palette.divider),justifyContent:"center",alignItems:"center",maxHeight:"90vh",height:"90vh",overflow:"auto"}}}))(),t=Object(r.useState)("hot"),n=Object(d.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(""),c=Object(d.a)(s,2),u=c[0],l=c[1];return a.a.createElement(f.a,{container:!0,component:"main",className:e.root},a.a.createElement(we,{setSelectedBoard:o,setSearchBoardText:l}),a.a.createElement(pe,{selectedBoard:i,searchBoardText:u}))}var Oe=n(154),je=n.n(Oe),Se=n(156),Be=n.n(Se),Ce=n(318),_e=n(309),Te=n(323),Le=n(319),Pe=n(155),We=n.n(Pe),Ne=n(332);function Ie(e){var t=Object(E.a)((function(e){return{root:{width:"100%",paddingLeft:"4vw",paddingRight:"2vw",paddingBottom:"12px"},divider:{height:"100%",margin:4},type:{flexBasis:"10%"},text:{flexBasis:"75%"},form:{width:"100%",display:"flex"},button:{fontSize:"0.6rem",height:"fit-content",flexBasis:"10%",alignSelf:"center"},sending:{flexBasis:"5%",alignSelf:"center",marginLeft:"4px"},lp:{width:"100%"}}})),n=he(),i=n.articleContent,o=t(),s=z(),c=Object(r.useState)(!1),u=Object(d.a)(c,2),l=u[0],h=u[1],v=Object(Q.b)(),g=v.handleSubmit,x=v.control,k=function(){var e=Object(m.a)(p.a.mark((function e(t){var r,a,o,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t),0!==(r=(r=t.text).trim()).length){e.next=5;break}return e.abrupt("return");case 5:return h(!0),a={type:t.type,text:r,boardName:i.info.boardname,aid:i.info.aid},o={type:"comment",arg:a},e.prev=8,e.next=11,s.executeCommand(o);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(8),console.log(e.t0),e.abrupt("return");case 17:return console.log("reload",i),e.prev=18,e.next=21,ue(s,Object(P.a)({},i));case 21:c=e.sent,n.setArticleContent(c),e.next=28;break;case 25:e.prev=25,e.t1=e.catch(18),console.log(e.t1);case 28:h(!1);case 29:case"end":return e.stop()}}),e,null,[[8,13],[18,25]])})));return function(t){return e.apply(this,arguments)}}();return a.a.createElement(f.a,{container:!0,component:"main",className:o.root},a.a.createElement("form",{onSubmit:g(k),className:o.form,noValidate:!0,autoComplete:"off"},a.a.createElement(_e.a,{className:o.type},a.a.createElement(Ne.a,null,"\u63a8\u6587\u985e\u578b"),a.a.createElement(Q.a,{as:a.a.createElement(Te.a,null,a.a.createElement(Ce.a,{value:"1"},"\u63a8"),a.a.createElement(Ce.a,{value:"2"},"\u5653"),a.a.createElement(Ce.a,{value:"3"},"\u2192")),name:"type",rules:{required:"this is required"},control:x,defaultValue:"1"})),a.a.createElement(Le.a,{className:o.divider,orientation:"vertical"}),a.a.createElement(Q.a,{className:o.text,as:a.a.createElement(y.a,{label:"\u5167\u5bb9",multiline:!0}),rules:{required:!0},name:"text",control:x,defaultValue:""}),a.a.createElement(b.a,{variant:"contained",color:"primary",className:o.button,endIcon:a.a.createElement(We.a,null),type:"submit"},"\u9001\u51fa"),a.a.createElement(f.a,{item:!0,className:o.sending},l&&a.a.createElement(F.a,{size:"1rem"}))))}function Re(e){var t=Object(E.a)((function(e){return{root:{alignItems:"center",maxHeight:"90vh",height:"90vh",overflow:"auto"},skeleton:{fontSize:"40px",width:"80%"},top:{height:"20vh",borderBottom:"1px solid rgba(0, 0, 0, 0.12)",marginTop:"12px",flexWrap:"nowrap",paddingLeft:"4vw"},goback:{width:"4vw",top:0,position:"absolute",zIndex:1001},info:{},titleText:{alignSelf:"center",flexBasis:"100%",flexGrow:"0",flexShrink:"0"},content:{paddingLeft:"4vw",paddingRight:"4vw",borderBottom:"2px solid rgba(0, 0, 0, 0.12)"},comment:{},author:{alignSelf:"center"},commentlist:{paddingTop:0,width:"100%"},contentlist:{width:"100%"},commentlist_item:{paddingLeft:"4vw",paddingRight:"2vw"},commentlist_type:{flexBasis:"5%"},commentlist_author:{flexBasis:"20%"},commentlist_text:{flexBasis:"65%"},commentlist_timestamp:{flexBasis:"10%"},lit:{whiteSpace:"pre"}}})),n=he(),i=n.articleContent,o=t(),s=a.a.createRef();return Object(r.useEffect)((function(){1===n.index&&(s.current.scrollTop=0)}),[n.index]),a.a.createElement(f.a,{container:!0,ref:s,component:"main",className:o.root},a.a.createElement(v.a,null),n.index?a.a.createElement(ve.a,{onClick:function(e){n.setIndex(0)},className:o.goback},a.a.createElement(Be.a,null)):"",a.a.createElement(f.a,{container:!0,className:o.top},a.a.createElement(f.a,{container:!0,className:o.info},a.a.createElement(w.a,{className:o.author,variant:"body1"},i.info.author),a.a.createElement(w.a,{variant:"h5",className:o.titleText},i.info.title),a.a.createElement(w.a,{className:o.boardName,variant:"body2"},i.info.boardname),a.a.createElement(w.a,{className:o.timestamp,variant:"body2"},"\u30fb",i.info.timestamp),a.a.createElement(w.a,{className:o.ip,variant:"body2"},"\u30fb\u4f86\u81ea\uff1a",i.info.ip))),a.a.createElement(f.a,{container:!0,className:o.content},function(e){if(e){var t=e.map((function(e){return a.a.createElement(J.a,{disableGutters:!0,className:o.lit},a.a.createElement(Z.a,{primary:e}))}));return a.a.createElement(V.a,{className:o.contentlist},t)}return""}(i.content)),a.a.createElement(f.a,{container:!0,className:o.comment},function(e){if(e){var t=e.map((function(e){return a.a.createElement(J.a,{disableGutters:!0,divider:!0,className:o.commentlist_item,key:e.floor},e.type?a.a.createElement(Z.a,{className:o.commentlist_type,primary:e.type}):"",e.author?a.a.createElement(Z.a,{className:o.commentlist_author,primary:e.author}):"",a.a.createElement(Z.a,{className:o.commentlist_text,primary:e.text}),e.timestamp?a.a.createElement(Z.a,{className:o.commentlist_timestamp,primary:e.floor+"F",secondary:e.timestamp}):"")}));return a.a.createElement(V.a,{className:o.commentlist},t)}return""}(i.comment)),a.a.createElement(f.a,{container:!0,className:o.sendComment},a.a.createElement(Ie,null)))}var Me=n(15);var Ae=n(66),De=n.n(Ae),He=function(e,t){return(He=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var Ye=function(){return(Ye=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};var ze="Pixel",Fe="Percent",Qe={unit:Fe,value:.8};var Ue=function(e){function t(t){var n=e.call(this,t)||this;return n.lastScrollTop=0,n.actionTriggered=!1,n.startY=0,n.currentY=0,n.dragging=!1,n.maxPullDownDistance=0,n.getScrollableTarget=function(){return n.props.scrollableTarget instanceof HTMLElement?n.props.scrollableTarget:"string"===typeof n.props.scrollableTarget?document.getElementById(n.props.scrollableTarget):(null===n.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},n.onStart=function(e){n.lastScrollTop||(n.dragging=!0,e instanceof MouseEvent?n.startY=e.pageY:e instanceof TouchEvent&&(n.startY=e.touches[0].pageY),n.currentY=n.startY,n._infScroll&&(n._infScroll.style.willChange="transform",n._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},n.onMove=function(e){n.dragging&&(e instanceof MouseEvent?n.currentY=e.pageY:e instanceof TouchEvent&&(n.currentY=e.touches[0].pageY),n.currentY<n.startY||(n.currentY-n.startY>=Number(n.props.pullDownToRefreshThreshold)&&n.setState({pullToRefreshThresholdBreached:!0}),n.currentY-n.startY>1.5*n.maxPullDownDistance||n._infScroll&&(n._infScroll.style.overflow="visible",n._infScroll.style.transform="translate3d(0px, "+(n.currentY-n.startY)+"px, 0px)")))},n.onEnd=function(){n.startY=0,n.currentY=0,n.dragging=!1,n.state.pullToRefreshThresholdBreached&&n.props.refreshFunction&&n.props.refreshFunction(),requestAnimationFrame((function(){n._infScroll&&(n._infScroll.style.overflow="auto",n._infScroll.style.transform="none",n._infScroll.style.willChange="none")}))},n.onScrollListener=function(e){"function"===typeof n.props.onScroll&&setTimeout((function(){return n.props.onScroll&&n.props.onScroll(e)}),0);var t=n.props.height||n._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;n.actionTriggered||(n.isElementAtBottom(t,n.props.scrollThreshold)&&n.props.hasMore&&(n.actionTriggered=!0,n.setState({showLoader:!0}),n.props.next&&n.props.next()),n.lastScrollTop=t.scrollTop)},n.state={showLoader:!1,pullToRefreshThresholdBreached:!1},n.throttledOnScrollListener=function(e,t,n,r){var a,i=!1,o=0;function s(){a&&clearTimeout(a)}function c(){var c=this,u=Date.now()-o,l=arguments;function f(){o=Date.now(),n.apply(c,l)}function d(){a=void 0}i||(r&&!a&&f(),s(),void 0===r&&u>e?f():!0!==t&&(a=setTimeout(r?d:f,void 0===r?e-u:e)))}return"boolean"!==typeof t&&(r=n,n=t,t=void 0),c.cancel=function(){s(),i=!0},c}(150,n.onScrollListener).bind(n),n.onStart=n.onStart.bind(n),n.onMove=n.onMove.bind(n),n.onEnd=n.onEnd.bind(n),n}return function(e,t){function n(){this.constructor=e}He(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.componentDidMount=function(){if("undefined"===typeof this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"===typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!==typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.props.key===e.key&&this.props.dataLength===e.dataLength||(this.actionTriggered=!1,this.setState({showLoader:!1,pullToRefreshThresholdBreached:!1}))},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var n=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,r=function(e){return"number"===typeof e?{unit:Fe,value:100*e}:"string"===typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:ze,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:Fe,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),Qe):(console.warn("scrollThreshold should be string or number"),Qe)}(t);return r.unit===ze?e.scrollTop+n>=e.scrollHeight-r.value:e.scrollTop+n>=r.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=Ye({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),n=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),r=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto",width:"100%"}:{width:"100%"};return De.a.createElement("div",{style:r,className:"infinite-scroll-component__outerdiv"},De.a.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&De.a.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},De.a.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!n&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(Ae.Component);function $e(e){var t=Object(E.a)((function(e){return{root:{alignItems:"center",justifyContent:"center",maxHeight:"90vh",height:"90vh",overflow:"auto"},skeleton:{fontSize:"40px",width:"80%"},info:{position:"absolute",right:"0",backgroundColor:"rgba(0,0,0,0.1)"}}}))(),n=he(),i=z(),o=Object(r.useState)([]),s=Object(d.a)(o,2),c=s[0],u=s[1];Object(r.useEffect)((function(){if(n.articleList.length>0){var e=n.articleList.map((function(e){return function(e){var t=e.item,n=e.info,r=e.BotContext,i=function(){var e=Object(m.a)(p.a.mark((function e(){var a,i,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.title.startsWith("(\u672c\u6587\u5df2\u88ab\u522a\u9664)")){e.next=2;break}return e.abrupt("return");case 2:return console.log("article item click:",n,t,r),e.prev=3,a=performance.now(),e.next=7,ie(t,r);case 7:i=e.sent,n.setIndex(1),n.setArticleContent(i),o=performance.now(),console.log("articleContent load time",o-a),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(){return e.apply(this,arguments)}}();return a.a.createElement(J.a,{onClick:i,button:!0,key:t.id,divider:!0,style:{height:"9vh"}},a.a.createElement(J.a,{style:{flexBasis:"15%",flexGrow:"0",flexShrink:"0"}},a.a.createElement(Z.a,{primary:a.a.createElement(w.a,{variant:"body2"},t.push)}),"R:"===t.status&&a.a.createElement(Z.a,{primary:a.a.createElement(w.a,{variant:"body2"},"RE:"),style:{textAlign:"right"}})),a.a.createElement(Z.a,{primary:a.a.createElement(w.a,{variant:"body1"},t.title),secondary:a.a.createElement(w.a,{variant:"body2"},t.author),style:{flexBasis:"60%",flexGrow:"0",flexShrink:"0"}}),a.a.createElement(Z.a,{primary:a.a.createElement(w.a,{variant:"body2"},t.date),secondary:a.a.createElement(w.a,{variant:"body2"},"id:",t.id)}),a.a.createElement(X.a,{style:{justifyContent:"center"}},a.a.createElement(ee.a,null)))}({item:e,info:n,BotContext:i})}));u(e)}}),[n]);return a.a.createElement(f.a,{container:!0,component:"main",className:t.root,id:"scrollableDiv"},a.a.createElement(v.a,null),a.a.createElement(f.a,{item:!0,className:t.skeleton},0===n.articleList.length&&a.a.createElement(q.a,{count:3})),n.articleList.length>0&&a.a.createElement(f.a,{container:!0},a.a.createElement(f.a,{item:!0,className:t.info},"\u770b\u677f\uff1a",n.boardName),a.a.createElement(Ue,{style:{overflow:"inherit"},scrollableTarget:"scrollableDiv",dataLength:c.length,next:function(){if(0!==n.articleList.length){console.log("handleLoadMore",n);var e=n.articleList[n.articleList.length-1].id,t=i.bot.select(te.Article).where("boardname",n.boardName).where("id",e);i.executeCommand({type:"select",arg:t}).then((function(t){if(console.log("res",t),!t)return!1;var r=t.reduce((function(t,n){return n.id<e&&t.push(n),t}),[]);n.setArticleList([].concat(Object(Me.a)(n.articleList),Object(Me.a)(r)))}))}},hasMore:!0,loader:a.a.createElement(F.a,{color:"secondary",size:12,className:t.loading}),endMessage:a.a.createElement("p",{style:{textAlign:"center"}},a.a.createElement("b",null,"Yay! You have seen it all"))},c)))}function Ge(){var e=Object(E.a)((function(e){return{root:{maxHeight:"80vh",overflow:"auto"},skeleton:{fontSize:"40px",width:"80%"}}})),t=he();e();return a.a.createElement(je.a,{index:t.index,onChangeIndex:function(e){t.setIndex(e)}},a.a.createElement($e,null),a.a.createElement(Re,null))}var qe=n(16),Ve=n(14),Je=n(320),Xe=Object(E.a)((function(e){return{toolbar:{borderBottom:"1px solid ".concat(e.palette.divider),position:"sticky",display:"flex"},toolbarTitle:{flex:1},toolbarSecondary:{justifyContent:"space-between",overflowX:"auto"},toolbarLink:{padding:e.spacing(1),flexShrink:0},search:{position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(Ve.c)("#f1f3f4",1),"&:hover":{backgroundColor:Object(Ve.c)("#ffffff",1)},width:"40vw"},searchIcon:{padding:e.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:Object(qe.a)({padding:e.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(e.spacing(4),"px)"),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("sm"),{width:"12ch","&:focus":{width:"20ch"}}),title:{fontFamily:"Crimson Text",fontSize:"32px",marginRight:"16vw"}}}));function Ze(e){var t=Xe();return a.a.createElement(a.a.Fragment,null,a.a.createElement(Je.a,{className:t.toolbar},a.a.createElement("div",{className:t.title},"ModernPTT"),a.a.createElement("div",{className:t.search},a.a.createElement("div",{className:t.searchIcon},a.a.createElement(ge.a,null)),a.a.createElement(xe.a,{placeholder:"\u641c\u5c0b\u770b\u677f",classes:{root:t.inputRoot,input:t.inputInput},inputProps:{"aria-label":"search"}}))))}var Ke=n(322),et=n(328),tt=n(325),nt=Object(E.a)((function(e){return{}}));function rt(){nt();var e=A(),t=e.isSnackbarOpen,n=e.setIsSnackbarOpen,r=e.snackbarContent;function i(e){return a.a.createElement(tt.a,Object.assign({elevation:6,variant:"filled"},e))}return a.a.createElement(et.a,{open:t,autoHideDuration:1e3,onClose:function(e,t){"clickaway"!==t&&n(!1)}},a.a.createElement(i,{severity:r.severity},r.text))}var at=n(326),it=n(157),ot=n(321),st=Object(it.a)({typography:{body1:{fontSize:"0.8rem"},body2:{fontSize:"0.65rem"},h5:{fontSize:"1rem",fontWeight:"bold"}}});function ct(){return a.a.createElement(T,null,a.a.createElement(M,null,a.a.createElement(Y,null,a.a.createElement(de,null,a.a.createElement(ot.a,{theme:st},a.a.createElement(Ke.a,{component:"main",maxWidth:"lg",disableGutters:"true"},a.a.createElement(v.a,null),a.a.createElement($,null),a.a.createElement(f.a,{container:!0},a.a.createElement(f.a,{item:!0,xs:12},a.a.createElement(Ze,null)),a.a.createElement(at.a,{xsDown:!0},a.a.createElement(f.a,{item:!0,sm:3,direction:"column"},a.a.createElement(Ee,null))),a.a.createElement(f.a,{item:!0,xs:12,sm:9},a.a.createElement(Ge,null)),a.a.createElement(rt,null))))))))}var ut=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return a.a.createElement(ct,null)}}]),n}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(ut,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},32:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Article",{enumerable:!0,get:function(){return r.Article}}),Object.defineProperty(t,"Board",{enumerable:!0,get:function(){return a.Board}}),Object.defineProperty(t,"Mail",{enumerable:!0,get:function(){return i.Mail}});var r=n(234),a=n(236),i=n(237)},84:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"decode",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"encode",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"keymap",{enumerable:!0,get:function(){return o.default}});var a=r(n(226)),i=r(n(227)),o=r(n(228))},85:function(e,t,n){"use strict";var r=n(23);Object.defineProperty(t,"__esModule",{value:!0}),t.dbcswidth=i,t.getWidth=o,t.indexOfWidth=s,t.substrWidth=function(e,t,n,r){var a="undefined"===typeof r,i=r,c=n,u=0,l=0;"length"!==e&&(c=s(e,t,n),o(e,t.substr(0,c))<n&&(c+=1,u=Math.max(o(e,t.substr(0,c))-n,0)),a||(i=s(e,t.substr(c),r-u),l=Math.min(r,o(e,t.substr(c)))-(u+o(e,t.substr(c,i)))));var f=a?t.substr(c):t.substr(c,i);return" ".repeat(u)+f+" ".repeat(l)};var a=r(n(122));function i(e){return e.split("").reduce((function(e,t){return e+(t.charCodeAt(0)>255?2:1)}),0)}function o(e,t){switch(e){case"length":return t.length;case"wcwidth":return(0,a.default)(t);case"dbcs":return i(t);default:throw new Error('Invalid widthType "'.concat(e,'"'))}}function s(e,t,n){if("length"===e)return Math.min(n,t.length);for(var r=0;r<=t.length;r++)if(o(e,t.substr(0,r))>n)return r-1;return t.length}}},[[174,1,2]]]);
//# sourceMappingURL=main.13191b34.chunk.js.map